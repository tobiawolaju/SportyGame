<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportyGame API Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #1a237e;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        code {
            background-color: #eef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
        }
        pre {
            background-color: #eef;
            color: #2d2d2d;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .endpoint {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 25px;
        }
        .method {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            color: #fff;
            margin-right: 10px;
        }
        .get { background-color: #4caf50; }
        .post { background-color: #2196f3; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <h1>SportyGame API Documentation</h1>
    <p>This document details the API endpoints for the SportyGame platform, powered by a Google Apps Script Web App connected to a Google Sheet.</p>

    <h2>Base URL</h2>
    <p>All API endpoints are relative to the following base URL:</p>
    <pre><code>https://script.google.com/macros/s/AKfycbwc3a83MfJncYiD4xUyn_CKTbRTm6RegDjKY84jKgDGuXq4QmCE5pmopV-e0T88OcCdFg/exec</code></pre>

    <hr>

    <h2>Data Models (Sheets)</h2>
    <p>The API interacts with the following data structures, each corresponding to a sheet in the Google Spreadsheet.</p>

    <h3>Users</h3>
    <table>
        <thead><tr><th>Field Name</th><th>Notes</th></tr></thead>
        <tbody>
            <tr><td><code>wallet</code></td><td><strong>(pk)</strong> String. The user's wallet address.</td></tr>
            <tr><td><code>privy_user_id</code></td><td>String. The user's ID from Privy.</td></tr>
            <tr><td><code>created_at</code></td><td>ISO String. Timestamp of user creation.</td></tr>
            <tr><td><code>status</code></td><td>String. Enum: "active", "expired", "banned".</td></tr>
            <tr><td><code>pass_expires_at</code></td><td>ISO String. Timestamp when their pass expires.</td></tr>
            <tr><td><code>last_seen_at</code></td><td>ISO String. Timestamp of the user's last activity.</td></tr>
        </tbody>
    </table>

    <h3>Matches</h3>
    <table>
        <thead><tr><th>Field Name</th><th>Notes</th></tr></thead>
        <tbody>
            <tr><td><code>match_id</code></td><td><strong>(pk)</strong> String. Unique ID for the match.</td></tr>
            <tr><td><code>title</code></td><td>String. The name of the match.</td></tr>
            <tr><td><code>game</code></td><td>String. Default: "PUBG".</td></tr>
            <tr><td><code>mode</code></td><td>String. E.g., "solo", "duo", "squad".</td></tr>
            <tr><td><code>region</code></td><td>String. E.g., "EU", "NA", "global".</td></tr>
            <tr><td><code>start_time_utc</code></td><td>ISO String. The scheduled start time.</td></tr>
            <tr><td><code>entry_cap</code></td><td>Integer. Maximum number of entries.</td></tr>
            <tr><td><code>join_deadline_utc</code></td><td>ISO String. Time after which joining is not allowed.</td></tr>
            <tr><td><code>status</code></td><td>String. Enum: "upcoming", "live", "closed".</td></tr>
            <tr><td><code>admin_notes</code></td><td>String. Internal notes for administrators.</td></tr>
            <tr><td><code>lobby_code</code></td><td>String. The game lobby code. <strong>(Hidden from GET requests)</strong></td></tr>
        </tbody>
    </table>

    <h3>Entries</h3>
    <table>
        <thead><tr><th>Field Name</th><th>Notes</th></tr></thead>
        <tbody>
            <tr><td><code>entry_id</code></td><td><strong>(pk)</strong> String. Unique ID for the entry.</td></tr>
            <tr><td><code>match_id</code></td><td>String. Foreign key to the Matches sheet.</td></tr>
            <tr><td><code>wallet</code></td><td>String. Foreign key to the Users sheet.</td></tr>
            <tr><td><code>joined_at</code></td><td>ISO String. Timestamp when the user joined.</td></tr>
            <tr><td><code>checked_in</code></td><td>Boolean. Whether the user has checked in.</td></tr>
            <tr><td><code>result</code></td><td>String. Enum: "pending", "win", "loss", "dq".</td></tr>
        </tbody>
    </table>
    
    <h3>Payments</h3>
    <table>
        <thead><tr><th>Field Name</th><th>Notes</th></tr></thead>
        <tbody>
            <tr><td><code>tx_hash</code></td><td><strong>(pk)</strong> String. The transaction hash of the payment.</td></tr>
            <tr><td><code>wallet</code></td><td>String. Payer's wallet address.</td></tr>
            <tr><td><code>chain</code></td><td>String. E.g., "base".</td></tr>
            <tr><td><code>token</code></td><td>String. E.g., "USDC".</td></tr>
            <tr><td><code>amount</code></td><td>Number. The amount paid.</td></tr>
            <tr><td><code>block_time</code></td><td>ISO String. Timestamp of the transaction.</td></tr>
            <tr><td><code>type</code></td><td>String. E.g., "subscription".</td></tr>
            <tr><td><code>parsed_ok</code></td><td>Boolean. If the payment was parsed correctly.</td></tr>
            <tr><td><code>notes</code></td><td>String. Additional notes.</td></tr>
        </tbody>
    </table>

    <h3>Payouts</h3>
    <table>
      <thead><tr><th>Field Name</th><th>Notes</th></tr></thead>
      <tbody>
          <tr><td><code>payout_id</code></td><td><strong>(pk)</strong> String. Unique ID for the payout.</td></tr>
          <tr><td><code>match_id</code></td><td>String. The match for which the payout was awarded.</td></tr>
          <tr><td><code>wallet</code></td><td>String. The recipient's wallet address.</td></tr>
          <tr><td><code>amount</code></td><td>Number. The amount paid out.</td></tr>
          <tr><td><code>tx_hash</code></td><td>String. The payout transaction hash.</td></tr>
          <tr><td><code>awarded_by</code></td><td>String. Admin who issued the payout.</td></tr>
          <tr><td><code>awarded_at</code></td><td>ISO String. Timestamp of the award.</td></tr>
      </tbody>
  </table>

    <hr>

    <h2>API Endpoints</h2>

    <!-- ================== MATCHES ================== -->
    <h3>Matches Endpoints</h3>
    <div class="endpoint">
        <h4>List All Matches</h4>
        <p><span class="method get">GET</span><code>/matches</code></p>
        <p>Retrieves a list of all match objects. The <code>lobby_code</code> field is omitted from the response.</p>
        <h4>Example Success Response:</h4>
        <pre><code>[
  {
    "match_id": "M_1755690350791_9509",
    "title": "Solo Scrim #1",
    "status": "upcoming",
    ...
  },
  ...
]</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function getAllMatches() {
  const url = "BASE_URL/exec?query=matches";
  const response = await fetch(url);
  const matches = await response.json();
  console.log(matches);
}</code></pre>
    </div>

    <div class="endpoint">
        <h4>Create a New Match</h4>
        <p><span class="method post">POST</span><code>/matches</code></p>
        <p>Creates a new match record. The <code>match_id</code> is generated automatically by the server.</p>
        <h4>Example Request Body:</h4>
        <pre><code>{
  "title": "Duo Scrim #1",
  "mode": "duo",
  "region": "NA",
  "start_time_utc": "2025-09-02T19:00:00Z",
  "entry_cap": 50,
  "join_deadline_utc": "2025-09-02T18:50:00Z",
  "status": "upcoming",
  "admin_notes": "invite-only",
  "lobby_code": "XYZ999"
}</code></pre>
        <h4>Example Success Response:</h4>
        <pre><code>{ "ok": true, "match_id": "M_1755690353650_1279" }</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function createMatch(matchData) {
  const url = "BASE_URL/exec?query=matches";
  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(matchData)
  });
  const result = await response.json();
  console.log(result);
}</code></pre>
    </div>

    <!-- ================== USERS ================== -->
    <h3>Users Endpoints</h3>
    <div class="endpoint">
        <h4>List All Users</h4>
        <p><span class="method get">GET</span><code>/users</code></p>
        <p>Retrieves a list of all user objects from the sheet.</p>
        <h4>Example Success Response:</h4>
        <pre><code>[
  {
    "wallet": "0xabc111",
    "privy_user_id": "usr_001",
    "status": "active",
    ...
  },
  ...
]</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function getAllUsers() {
  const url = "BASE_URL/exec?query=users";
  const response = await fetch(url);
  const users = await response.json();
  console.log(users);
}</code></pre>
    </div>

    <div class="endpoint">
        <h4>Create a New User</h4>
        <p><span class="method post">POST</span><code>/users</code></p>
        <p>Creates a new user record. <code>created_at</code> and <code>last_seen_at</code> are set automatically.</p>
        <h4>Example Request Body:</h4>
        <pre><code>{
  "wallet": "0xabc111",
  "privy_user_id": "usr_001",
  "status": "active",
  "pass_expires_at": "2025-09-01T10:00:00Z"
}</code></pre>
        <h4>Example Success Response:</h4>
        <pre><code>{ "ok": true }</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function createUser(userData) {
  const url = "BASE_URL/exec?query=users";
  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(userData)
  });
  const result = await response.json();
  console.log(result);
}</code></pre>
    </div>

    <!-- ================== ENTRIES ================== -->
    <h3>Entries Endpoints</h3>
    <div class="endpoint">
        <h4>Join a Match</h4>
        <p><span class="method post">POST</span><code>/join</code></p>
        <p>Creates an entry for a user in a specific match. The server generates <code>entry_id</code>, <code>joined_at</code>, and sets defaults for <code>checked_in</code> and <code>result</code>.</p>
        <h4>Example Request Body:</h4>
        <pre><code>{
  "wallet": "0xabc111",
  "match_id": "M_1755690353650_1279"
}</code></pre>
        <h4>Example Success Response:</h4>
        <pre><code>{ "ok": true, "entry_id": "E_1755708857490_2569" }</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function joinMatch(wallet, matchId) {
  const url = "BASE_URL/exec?query=join";
  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ wallet: wallet, match_id: matchId })
  });
  const result = await response.json();
  console.log(result);
}</code></pre>
    </div>

    <div class="endpoint">
        <h4>Check In to a Match</h4>
        <p><span class="method post">POST</span><code>/checkin</code></p>
        <p>Marks a user's entry for a match as "checked in".</p>
        <h4>Example Request Body:</h4>
        <pre><code>{
  "wallet": "0xabc111",
  "match_id": "M_1755690353650_1279"
}</code></pre>
        <h4>Example Success Response:</h4>
        <pre><code>{ "ok": true }</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function checkInToMatch(wallet, matchId) {
  const url = "BASE_URL/exec?query=checkin";
  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ wallet: wallet, match_id: matchId })
  });
  const result = await response.json();
  console.log(result);
}</code></pre>
    </div>
    
    <!-- ================== PAYMENTS & PAYOUTS ================== -->
    <h3>Financial Endpoints</h3>
    <div class="endpoint">
        <h4>Record a Payment</h4>
        <p><span class="method post">POST</span><code>/payment</code></p>
        <p>Records an incoming payment transaction into the payments sheet.</p>
        <h4>Example Request Body:</h4>
        <pre><code>{
  "tx_hash": "0xpay001",
  "wallet": "0xabc111",
  "chain": "base",
  "token": "USDC",
  "amount": 1,
  "block_time": "2025-08-01T10:05:00Z",
  "type": "subscription",
  "parsed_ok": true,
  "notes": "first monthly fee"
}</code></pre>
        <h4>Example Success Response:</h4>
        <pre><code>{ "ok": true }</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function recordPayment(paymentData) {
  const url = "BASE_URL/exec?query=payment";
  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(paymentData)
  });
  const result = await response.json();
  console.log(result);
}</code></pre>
    </div>

    <div class="endpoint">
        <h4>Record a Payout</h4>
        <p><span class="method post">POST</span><code>/payout</code></p>
        <p>Records a prize payout transaction. The <code>payout_id</code> is generated automatically.</p>
        <h4>Example Request Body:</h4>
        <pre><code>{
  "match_id": "M_1755690353650_1279",
  "wallet": "0xabc111",
  "amount": 5,
  "tx_hash": "0xpayout111",
  "awarded_by": "0xadmin"
}</code></pre>
        <h4>Example Success Response:</h4>
        <pre><code>{ "ok": true, "payout_id": "P_1755709512345_6789" }</code></pre>
        <h4>Example Code:</h4>
        <pre><code class="language-js">async function recordPayout(payoutData) {
  const url = "BASE_URL/exec?query=payout";
  const response = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payoutData)
  });
  const result = await response.json();
  console.log(result);
}</code></pre>
    </div>
    
</body>
</html>